<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Seller Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/seller.css') }}">
</head>
<body>
    <nav class="seller-nav">
        <div class="container">
            <h2>Seller Panel</h2>
            <div class="nav-links">
                <a href="{{ url_for('seller_dashboard') }}">Dashboard</a>
                <a href="{{ url_for('seller_products') }}" class="active">Products</a>
                <a href="{{ url_for('seller_banners') }}">Banners</a>
                <a href="{{ url_for('seller_orders') }}">Orders</a>
                <a href="{{ url_for('seller_logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <main class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="page-header">
            <h1>Product Management</h1>
            <button class="btn-primary" onclick="openModal('add-product-modal')">Add New Product</button>
        </div>

        <div class="products-table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>
                            {% if product.image_path %}
                            <img src="{{ url_for('static', filename=product.image_path) }}" 
                                 alt="{{ product.name }}" class="table-image">
                            {% else %}
                            <span class="no-image">No Image</span>
                            {% endif %}
                        </td>
                        <td>{{ product.name }}</td>
                        <td>${{ "%.2f"|format(product.price) }}</td>
                        <td>{{ product.quantity_available }} {% if product.unit_type == 'kg' %}kg{% else %}({{ product.unit_type }}){% endif %}</td>
                        <td>
                            {% if product.quantity_available > 0 %}
                                <span class="status-badge status-active">In stock</span>
                            {% else %}
                                <span class="status-badge status-inactive">Out of stock</span>
                            {% endif %}
                        </td>
                        <td class="product-actions-cell">
                            <button class="btn-edit" onclick="editProduct({{ product.id }}, '{{ product.name }}', '{{ product.description|replace("'", "\\'") }}', {{ product.original_price or 'null' }}, {{ product.price }}, {{ product.quantity_available }}, '{{ product.image_path }}', '{{ product.unit_type }}')">
                                Edit
                            </button>
                            <form method="POST" action="{{ url_for('mark_out_of_stock', id=product.id) }}" style="display:inline;">
                                <button type="submit" class="btn-out-of-stock">
                                    Mark Out of stock
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('delete_product', id=product.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this product? This action cannot be undone.');">
                                <button type="submit" class="btn-delete">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Add Product Modal -->
        <div id="add-product-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('add-product-modal')">&times;</span>
                <h2>Add New Product</h2>
                <form method="POST" action="{{ url_for('add_product') }}" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="name">Product Name *</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="original_price">Original Price (for strike-through)</label>
                        <input type="number" id="original_price" name="original_price" step="0.01" min="0" placeholder="Leave empty if no discount">
                    </div>
                    <div class="form-group">
                        <label for="price">Selling Price *</label>
                        <input type="number" id="price" name="price" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="quantity">Quantity Available *</label>
                        <input type="number" id="quantity" name="quantity" min="0" step="any" required>
                    </div>
                    <div class="form-group">
                        <label for="unit_type">Unit Type *</label>
                        <select id="unit_type" name="unit_type" required>
                            <option value="quantity">Quantity (e.g., pcs, dozen, litre)</option>
                            <option value="kg">Weight (kg) - Customer can select 100g, 250g, 500g, 750g, 1kg</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="image">Product Image</label>
                        <input type="file" id="image" name="image" accept="image/*">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('add-product-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Add Product</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Product Modal -->
        <div id="edit-product-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('edit-product-modal')">&times;</span>
                <h2>Edit Product</h2>
                <form id="edit-product-form" method="POST" action="" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="edit-name">Product Name *</label>
                        <input type="text" id="edit-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-description">Description</label>
                        <textarea id="edit-description" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-original_price">Original Price (for strike-through)</label>
                        <input type="number" id="edit-original_price" name="original_price" step="0.01" min="0" placeholder="Leave empty if no discount">
                    </div>
                    <div class="form-group">
                        <label for="edit-price">Selling Price *</label>
                        <input type="number" id="edit-price" name="price" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-quantity">Quantity Available *</label>
                        <input type="number" id="edit-quantity" name="quantity" min="0" step="any" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-unit_type">Unit Type *</label>
                        <select id="edit-unit_type" name="unit_type" required>
                            <option value="quantity">Quantity (e.g., pcs, dozen, litre)</option>
                            <option value="kg">Weight (kg) - Customer can select 100g, 250g, 500g, 750g, 1kg</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-image">Product Image (leave empty to keep current)</label>
                        <input type="file" id="edit-image" name="image" accept="image/*">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('edit-product-modal')">Cancel</button>
                        <button type="submit" class="btn-primary">Update Product</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/seller.js') }}"></script>
</body>
</html>


